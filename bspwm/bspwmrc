#! /bin/sh

exec &> ~/.bspwm_startup_log

# --- Monitor Configuration ---
# MON_LEFT="DP-1-0"
MON_CENTER="DP-1-3"
MON_RIGHT="eDP-2"

# Attempt to configure all monitors.
# If this fails, try reducing refresh rates (e.g., to 144Hz or 120Hz for MON_LEFT and MON_CENTER if 165Hz is too much for the pair).
# Both DP-1-0 and DP-1-3 support 144Hz (DP-1-0: 144.00, DP-1-3: 143.99) and ~120Hz.
# eDP-2 also has 60Hz options if 165Hz is problematic in a multi-monitor setup.
xrandr \
    --output "$MON_CENTER" --primary --mode 1920x1080 --rate 165.00 --pos 0x0 \
    --output "$MON_RIGHT"  --mode 2560x1440 --rate 165.00 --scale 0.6x0.6 --pos 1920x0 \

xsetroot -cursor_name left_ptr 

pgrep -x sxhkd > /dev/null || sxhkd &

# bspc monitor "$MON_LEFT"   -d 1 2 
bspc monitor "$MON_CENTER" -d 1 2 3 # Primary monitor gets more desktops
bspc monitor "$MON_RIGHT"  -d 4 5 6

#bspc wm -r # Reloads bspwm to recognize monitor changes
#bspc monitor -d 1 2 3 4 5 6 7 8 9 10 # bspwm distributes these across detected monitors
bspc config border_width        2
bspc config window_gap          8

bspc config split_ratio          0.52
bspc config borderless_monocle   true
bspc config gapless_monocle      true
bspc config focus_follows_pointer true
bspc config pointer_follows_focus false

bspc rule -a Yad state=floating follow=on center=true focus=on
bspc rule -a pavucontrol state=floating follow=on center=true focus=on
bspc rule -a discord desktop='^4' 
bspc rule -a RMPC desktop='^5' 
bspc rule -a CAVA desktop='^5' 

bspc rule -a "*\.exe" state=fullscreen

# bspc rule -a mplayer2 state=floating
# bspc rule -a Kupfer.py focus=on
# bspc rule -a Screenkey manage=off

# Polybar

# Terminate already running bar instances
polybar-msg cmd quit &> /dev/null # Suppress error if no instances running
## Wait for polybar processes to terminate before launching new ones
while pgrep -u $UID -x polybar >/dev/null; do sleep 0.5; done

# MONITOR=$MON_LEFT polybar --reload main -c ~/.config/polybar/config.ini &
MONITOR=$MON_CENTER polybar --reload main -c ~/.config/polybar/config.ini &
MONITOR=$MON_RIGHT polybar --reload main -c ~/.config/polybar/config.ini &

# Start XDG Desktop Portal services
/usr/lib/xdg-desktop-portal-gtk &
/usr/lib/xdg-desktop-portal &

picom --config ~/.config/picom/picom.conf -b
blueman-applet &
dunst &
feh --bg-fill /home/senohebat/Pictures/background.jpg &

kitty --class RMPC rmpc &
kitty --class CAVA cava &
flatpak run com.discordapp.Discord &
